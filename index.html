<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026跨年倒计时</title>
<style>
    *{margin:0;padding:0;box-sizing:border-box;overflow:hidden;}
    body{
        width:100vw;height:100vh;
        background:#05001a;
        display:flex;justify-content:center;align-items:center;
        font-family:"Microsoft Yahei",sans-serif;
        cursor:pointer;
    }
    /* 顶部时间跳动 */
    .initial-countdown{font-size:24px;font-weight:bold;text-align:center;animation:colorShift 2s infinite alternate;position:absolute;top:20px;z-index:50;}
    @keyframes colorShift{0%{color:#ff3366;}25%{color:#33ccff;}50%{color:#ffd700;}75%{color:#9933ff;}100%{color:#33ff66;}}
    
    /* 3/2/1 倒数 */
    .big-count{font-size:15vw;font-weight:900;text-align:center;display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);animation:scaleBlink 1s ease-in-out forwards;z-index:100;}
    @keyframes scaleBlink{0%{opacity:0;transform:translate(-50%,-50%) scale(0.5);}50%{opacity:1;transform:translate(-50%,-50%) scale(1.1);}100%{opacity:0;transform:translate(-50%,-50%) scale(1.8);}}
    
    /* 祝福语：4秒后开始2秒平滑闪退 */
    .greeting{
        font-family:"Ma Shan Zheng",sans-serif;
        font-size:35px;font-weight:bold;
        color:white;
        position:absolute;top:30%;left:50%;
        transform:translateX(-50%);
        display:none;
        z-index:10;
        opacity:1;
        transition: opacity 2s ease; 
    }
    
    canvas{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;}
    .audio-tip{position:absolute;bottom:20px;color:#fff;opacity:0.7;font-size:14px;text-align:center;z-index:20;}
</style>
<link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
</head>
<body>

<div class="initial-countdown" id="initialCount"></div>
<div class="big-count" id="count3">3</div>
<div class="big-count" id="count2">2</div>
<div class="big-count" id="count1">1</div>
<div class="greeting" id="greeting1">새해 복 많이 받으세요</div>
<div class="audio-tip" id="audioTip">✨ 点击屏幕激活新年氛围 ✨</div>
<canvas id="canvas"></canvas>

<div style="display:none">
    <audio id="sound1" src="1.mp3" preload="auto"></audio>
    <audio id="sound2" src="2.mp3" preload="auto"></audio>
    <audio id="sound3" src="3.mp3" preload="auto"></audio>
</div>

<script>
const initialCountEl=document.getElementById('initialCount');
const countEls=[document.getElementById('count3'),document.getElementById('count2'),document.getElementById('count1')];
const greeting1El=document.getElementById('greeting1');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const s1=document.getElementById('sound1'), s2=document.getElementById('sound2'), s3=document.getElementById('sound3');

let particles=[];
let fireworkStartTime = 0;
let allowSounds = true;

canvas.width=window.innerWidth;
canvas.height=window.innerHeight;
window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;});

function padZero(n){return n.toString().padStart(2,'0');}

// ===== 1. 时钟模拟 (23:59:57) =====
let currentTime=new Date('2025-12-31T23:59:57').getTime();
const endTime=new Date('2026-01-01T00:00:00').getTime();

function updateInitialCount(){
    const date=new Date(currentTime);
    initialCountEl.textContent=`${date.getFullYear()}-${padZero(date.getMonth()+1)}-${padZero(date.getDate())} ${padZero(date.getHours())}:${padZero(date.getMinutes())}:${padZero(date.getSeconds())}`;
    if(currentTime>=endTime){
        clearInterval(initialInterval);
        initialCountEl.style.display='none';
        startBigCountdown();
    }
    currentTime+=1000;
}
const initialInterval=setInterval(updateInitialCount,1000);
updateInitialCount();

// ===== 2. 3-2-1 倒计时逻辑 =====
function startBigCountdown(){
    let i=0;
    const timer=setInterval(()=>{
        if(i>0) countEls[i-1].style.display='none';
        if(i<3){
            countEls[i].style.display='block';
            i++;
        }else{
            clearInterval(timer);
            startFireworksPhase();
        }
    },1000);
}

// ===== 3. 烟花粒子逻辑 =====
class Particle{
    constructor(x,y,color){
        this.x=x;this.y=y;this.radius=Math.random()*2+1;
        this.color=color;this.vx=(Math.random()-0.5)*8;
        this.vy=(Math.random()-0.5)*8;this.alpha=1;this.gravity=0.06;
    }
    update(){this.x+=this.vx;this.y+=this.vy;this.vy+=this.gravity;this.alpha-=0.015;}
    draw(){
        ctx.save();ctx.globalAlpha=this.alpha;ctx.beginPath();
        ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);ctx.fillStyle=this.color;ctx.fill();ctx.restore();
    }
}

function createFirework(){
    const x=Math.random()*canvas.width;
    const y=Math.random()*canvas.height*0.55;
    const colors=["#ff0043","#14fc56","#1e90ff","#ffd700","#ff69b4"];
    const color=colors[Math.floor(Math.random()*colors.length)];

    // 【音效 32s 循环控制核心逻辑】
    if (fireworkStartTime > 0) {
        const elapsed = (Date.now() - fireworkStartTime) / 1000;
        const cycle = elapsed % 32;

        if (cycle < 9) {
            allowSounds = true;       // 0-9s 开启播放
        } else if (cycle < 15) {
            allowSounds = false;      // 9-15s 停止
        } else if (cycle < 25) {
            allowSounds = true;       // 15-25s 再次开启播放
        } else {
            allowSounds = false;      // 25-32s 再次停止
        }
    }

    if(allowSounds){
        [s1, s2, s3].forEach(s => {
            const clone = s.cloneNode();
            clone.volume = (s.id === 'sound1') ? 0.2 : 0.6;
            clone.play().catch(()=>{});
        });
    }

    for(let i=0;i<80;i++){particles.push(new Particle(x,y,color));}
}

function animate(){
    ctx.fillStyle="rgba(5,0,26,0.25)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    particles = particles.filter(p => {
        p.update();
        p.draw();
        return p.alpha > 0;
    });
    requestAnimationFrame(animate);
}

// ===== 4. 启动阶段 =====
function startFireworksPhase(){
    fireworkStartTime = Date.now();
    greeting1El.style.display='block';
    
    // 祝福语：4秒后开始缓慢闪退
    setTimeout(() => {
        greeting1El.style.opacity = '0';
    }, 4000);

    setInterval(createFirework, 750);
    animate();
}

// ===== 5. 交互激活 =====
document.body.addEventListener('click',()=>{
    [s1, s2, s3].forEach(s => { s.play().then(()=>{s.pause(); s.currentTime=0;}).catch(()=>{}); });
    document.getElementById('audioTip').style.display='none';
},{once:true});
</script>
</body>
</html>
