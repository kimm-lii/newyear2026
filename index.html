<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新年快乐</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; overflow: hidden; }
        body {
            width: 100vw; height: 100vh;
            background: #05001a;
            display: flex; justify-content: center; align-items: center;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            cursor: pointer;
            color: white;
        }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        /* 居中彩色跳动时间 */
        .initial-countdown { 
            font-size: clamp(24px, 6vw, 48px); 
            font-weight: 900; 
            text-align: center; 
            position: absolute; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            z-index: 50;
            background: linear-gradient(to right, #ff3366, #ffdb58, #33ccff, #9933ff, #33ff66);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 3s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }

        /* 大数字倒数 */
        .big-count { 
            font-size: 15vw; font-weight: 900; display: none; 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            z-index: 100; animation: scaleBlink 1s ease-in-out forwards; 
        }
        @keyframes scaleBlink {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.8); }
        }

        /* 祝福语 */
        .greeting {
            font-size: 40px; font-weight: bold;
            position: absolute; top: 35%; left: 50%;
            transform: translateX(-50%);
            display: none; z-index: 10;
            opacity: 1;
            transition: opacity 2s ease; 
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .audio-tip { position: absolute; bottom: 20px; color: #fff; opacity: 0.7; font-size: 14px; z-index: 20; }
    </style>
</head>
<body>

    <div class="initial-countdown" id="initialCount">CLICK TO START</div>
    <div class="big-count" id="count3">3</div>
    <div class="big-count" id="count2">2</div>
    <div class="big-count" id="count1">1</div>
    <div class="greeting" id="greeting1">새해 복 많이 받으세요</div>
    <div class="audio-tip" id="audioTip">Pot</div>
    <canvas id="canvas"></canvas>

    <div style="display:none">
        <audio id="sound1" src="1.mp3" preload="auto"></audio>
        <audio id="sound2" src="2.mp3" preload="auto"></audio>
        <audio id="sound3" src="3.mp3" preload="auto"></audio>
    </div>

<script>
    window.onload = function() {
        const initialCountEl = document.getElementById('initialCount');
        const countEls = [document.getElementById('count3'), document.getElementById('count2'), document.getElementById('count1')];
        const greeting1El = document.getElementById('greeting1');
        const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
        const s1 = document.getElementById('sound1'), s2 = document.getElementById('sound2'), s3 = document.getElementById('sound3');

        let particles = [], fireworkStartTime = 0, allowSounds = true, started = false;
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;

        function padZero(n) { return n.toString().padStart(2, '0'); }

        // 1. 时间逻辑 (23:59:57)
        let currentTime = new Date('2025-12-31T23:59:57').getTime();
        const endTime = new Date('2026-01-01T00:00:00').getTime();

        function updateInitialCount() {
            if(!started) return;
            const date = new Date(currentTime);
            initialCountEl.textContent = `${date.getFullYear()}-${padZero(date.getMonth() + 1)}-${padZero(date.getDate())} ${padZero(date.getHours())}:${padZero(date.getMinutes())}:${padZero(date.getSeconds())}`;
            
            if (currentTime >= endTime) {
                clearInterval(initialInterval);
                initialCountEl.style.display = 'none';
                startBigCountdown();
            }
            currentTime += 1000;
        }
        const initialInterval = setInterval(updateInitialCount, 1000);

        // 2. 倒计时阶段
        function startBigCountdown() {
            let i = 0;
            const timer = setInterval(() => {
                if (i > 0) countEls[i - 1].style.display = 'none';
                if (i < 3) {
                    countEls[i].style.display = 'block';
                    i++;
                } else {
                    clearInterval(timer);
                    startFireworksPhase();
                }
            }, 1000);
        }

        // 3. 烟花粒子逻辑
        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.radius = Math.random() * 2 + 1;
                this.color = color; this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8; this.alpha = 1; this.gravity = 0.06;
            }
            update() { this.x += this.vx; this.y += this.vy; this.vy += this.gravity; this.alpha -= 0.015; return this.alpha > 0; }
            draw() {
                ctx.save(); ctx.globalAlpha = this.alpha; ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); ctx.fillStyle = this.color; ctx.fill(); ctx.restore();
            }
        }

        function createFirework() {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height * 0.55;
            const colors = ["#ff0043", "#14fc56", "#1e90ff", "#ffd700", "#ff69b4"];
            const color = colors[Math.floor(Math.random() * colors.length)];

            if (fireworkStartTime > 0) {
                const elapsed = (Date.now() - fireworkStartTime) / 1000;
                const cycle = elapsed % 32;
                // 0-9s 播, 9-15s 关, 15-25s 播, 25-32s 关
                allowSounds = (cycle < 9 || (cycle >= 15 && cycle < 25));
            }

            if (allowSounds) {
                [s1, s2, s3].forEach(s => {
                    const clone = s.cloneNode();
                    // 逻辑：音频2 缩短声音 (设置在0.6秒后自动停止)
                    if(s.id === 'sound2') {
                        clone.volume = 0.7;
                        clone.play();
                        setTimeout(() => { 
                            clone.pause(); 
                            clone.remove(); 
                        }, 600); 
                    } else {
                        clone.volume = (s.id === 'sound1') ? 0.2 : 0.6;
                        clone.play().catch(() => {});
                    }
                });
            }
            for (let i = 0; i < 75; i++) particles.push(new Particle(x, y, color));
        }

        function animate() {
            ctx.fillStyle = "rgba(5,0,26,0.25)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            particles = particles.filter(p => { p.update(); p.draw(); return p.alpha > 0; });
            requestAnimationFrame(animate);
        }

        function startFireworksPhase() {
            fireworkStartTime = Date.now();
            greeting1El.style.display = 'block';
            setTimeout(() => { greeting1El.style.opacity = '0'; }, 4000);
            setInterval(createFirework, 700);
            animate();
        }

        // 交互激活
        document.body.onclick = function() {
            if(!started) {
                started = true;
                initialCountEl.style.top = '50%'; // 确保居中
                document.getElementById('audioTip').style.opacity = '0.3';
                [s1, s2, s3].forEach(s => { s.play().then(()=>{s.pause(); s.currentTime=0;}).catch(()=>{}); });
                updateInitialCount();
            }
        };

        window.onresize = function() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    };
</script>
</body>
</html>
